{% extends "base.html" %}

{% block title %}Новая поездка | TravelPlanner{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .point-form {
        background: #f8f9fa;
        border-left: 4px solid var(--primary);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="form-container">
        <h1>Новая поездка</h1>
        
        <form method="POST" action="{{ url_for('create_trip_route') }}">
            <div class="form-group">
                <label>Название поездки</label>
                <input type="text" name="title" class="form-control" required>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <label>Дата начала</label>
                    <input type="date" name="start_date" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label>Дата окончания</label>
                    <input type="date" name="end_date" class="form-control" required>
                </div>
            </div>
            
            <div id="points-container">
                <div class="point-form">
                    <div class="flex justify-between">
                        <h3>Точка маршрута #1</h3>
                        <button type="button" class="btn btn-danger remove-point">×</button>
                    </div>
                    <div class="form-group">
                        <label>Местоположение</label>
                        <input type="text" name="locations[]" class="form-control" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>Прибытие</label>
                            <input type="datetime-local" name="arrival_time[]" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label>Отъезд</label>
                            <input type="datetime-local" name="departure_time[]" class="form-control">
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="button" id="add-point" class="btn btn-outline">+ Добавить точку</button>
            
            <div class="flex justify-between">
                <a href="{{ url_for('get_trips') }}" class="btn btn-secondary">Отмена</a>
                <button type="submit" class="btn btn-primary">Сохранить</button>
            </div>
        </form>
    </div>
</div>

<script>
document.getElementById('add-point').addEventListener('click', function() {
    const newPoint = document.querySelector('.point-form').cloneNode(true);
    const pointsCount = document.querySelectorAll('.point-form').length + 1;
    newPoint.querySelector('h3').textContent = `Точка маршрута #${pointsCount}`;
    newPoint.querySelectorAll('input').forEach(input => input.value = '');
    document.getElementById('points-container').appendChild(newPoint);
});

document.addEventListener('click', function(e) {
    if(e.target.classList.contains('remove-point')) {
        e.target.closest('.point-form').remove();
    }
});
</script>
{% endblock %}